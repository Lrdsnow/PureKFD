//
//  KFD.swift
//  purekfd
//
//  Created by Lrdsnow on 7/12/24.
//

import Foundation
import SwiftKFD
import SwiftKFD_objc

class KFD: NSObject {
    
    @objc public static func overwriteFile(_ from: URL, to: URL) {
        overwriteFile2(from.path, to.path)
    }
    
    @objc public static func endExploit() {
        SmartKclose()
    }
    
    @objc public static func startExploit(_ json: [String:String]) -> Bool {
        do {
            if json["useCustomSettings"] == "true" {
                var puaf_pages: UInt64? = nil
                if let puaf_pages_str = json["puaf pages"] {
                    puaf_pages = UInt64(puaf_pages_str) ?? nil
                }
                var puaf_method: UInt64? = nil
                if let puaf_method_str = json["puaf method"] {
                    if puaf_method_str == "landa" {
                        puaf_method = 2
                    } else if puaf_method_str == "smith" {
                        puaf_method = 1
                    } else if puaf_method_str == "physpuppet" {
                        puaf_method = 0
                    }
                }
                var static_pages: Int = -1
                if let static_pages_str = json["use static headroom_static headroom"] {
                    static_pages = Int(static_pages_str) ?? -1
                }
                try SmartKopen(puaf_pages, puaf_method, static_pages, true)
            } else {
                try SmartKopen()
            }
            return true
        } catch {
            return false
        }
    }
    
}
